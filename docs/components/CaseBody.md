# CaseBody Component

## Overview

The `CaseBody` component is the central panel of the three-pane case viewer system. It renders the main content of a legal case, including the case title, parties, judgment date, and the full text of the legal document with professional legal document formatting.

- **File**: `lexx-app/src/components/cases/CaseBody.tsx`
- **Dependencies**: `react-markdown`, `remark-gfm`, `lucide-react`, Next.js `Link`
- **Parent Component**: `CaseViewer.tsx`

## Architecture

The component receives complete case data and intelligently renders it in two modes:
1. **Structured Mode**: When `plaintext_content` is available, parses Markdown content into legal document sections
2. **Fallback Mode**: When structured content is unavailable, displays case metadata and operative parts

The component generates a table of contents structure that's consumed by the `OperativePartsSidebar` component.

## Props

| Prop | Type | Required | Description |
|---|---|---|---|
| `caseData` | `CaseViewerData` | ✅ | Complete case data including content, metadata, and operative parts |
| `isMobile` | `boolean` | ❌ | Flag for mobile layout adjustments. Defaults to `false` |

## Key Features

### 📄 Legal Document Rendering
- **Professional Typography**: Uses serif fonts with legal document styling
- **Markdown Processing**: Converts Markdown content to HTML with custom legal-specific components
- **Section Parsing**: Automatically identifies and formats standard legal sections (Parties, Grounds, Operative Part)
- **Content Sanitization**: Cleans escaped characters common in legal text

### 🔗 Table of Contents Generation
- **ID Generation**: Creates valid CSS selectors for section navigation
- **Character Sanitization**: Handles special characters in legal headings (e.g., `**costs**` → `costs`)
- **Section Mapping**: Maps Markdown headers to navigable sections

### 📱 Responsive Design
- **Desktop Layout**: Paper-style document with shadows and borders
- **Mobile Layout**: Simplified styling optimized for small screens
- **Sticky Positioning**: Desktop version uses sticky positioning for optimal reading

### 🎨 Dark Mode Support
- **Theme-Aware Styling**: Complete dark mode color scheme
- **Prose Styling**: Uses `prose-invert` for dark mode markdown rendering
- **Consistent Branding**: Maintains legal document appearance in both themes

## Functionality

### Content Processing
```typescript
// Parses markdown into sections
const parseMarkdownContent = (content: string) => {
  const sections = content.split(/^## /gm).filter(Boolean)
  // Returns { [sectionTitle]: content } mapping
}

// Generates navigation structure
const generateTableOfContents = (content: string) => {
  const headers = content.match(/^## .+$/gm) || []
  // Returns array of { title, id } objects
}
```

### Section Rendering
- **Standard Legal Sections**: Automatically formats Parties, Grounds, and Operative Part
- **Custom Markdown Components**: Tailored rendering for legal document elements
- **Fallback Content**: Graceful handling when structured content is unavailable

### Navigation Integration
- **Back Navigation**: Desktop version includes "Back to cases" link
- **External Links**: Direct links to original legal sources
- **CELEX References**: Displays European legal identifier codes

## Usage Example

```tsx
// Used within CaseViewer three-pane layout
import { CaseBody } from '@/components/cases/CaseBody'

function CaseViewer({ caseId }: { caseId: string }) {
  const [caseData, setCaseData] = useState<CaseViewerData | null>(null)
  
  return (
    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
      {/* Left Sidebar */}
      <div className="lg:col-span-1">
        <OperativePartsSidebar caseData={caseData} />
      </div>
      
      {/* Main Content */}
      <div className="lg:col-span-2">
        <CaseBody caseData={caseData} isMobile={isMobile} />
      </div>
      
      {/* Right Sidebar */}
      <div className="lg:col-span-1">
        <ArticlesSidebar caseData={caseData} />
      </div>
    </div>
  )
}
```

## Related Components

- **`CaseViewer.tsx`**: Parent container that manages the three-pane layout
- **`OperativePartsSidebar.tsx`**: Consumes the table of contents generated by this component
- **`ArticlesSidebar.tsx`**: Shows articles interpreted by the case
- **`CaseInfoCard.tsx`**: Summary card used in case listings

## CSS Classes

The component uses Tailwind CSS with specific legal document styling:
- **Typography**: `font-serif`, `prose-lg` for professional legal text
- **Layout**: `max-w-4xl mx-auto` for optimal reading width
- **Theming**: `dark:` prefixed classes for dark mode support
- **Interactive**: Hover states for links and external references

## Performance Considerations

- **Markdown Processing**: Uses `react-markdown` with `remark-gfm` for GitHub-flavored markdown
- **Content Parsing**: Efficient regex-based section parsing
- **Sticky Positioning**: Desktop version uses CSS sticky for better UX during long document reading
- **Responsive Images**: Handles legal document images with proper optimization